title: "EcuadorPlantStackedSpeciesMaps"
author: "Hazel Anderson"
date: "6/30/2020"
output: html_document
---

# Load required packages
```{r}
library(BIEN)
library(ape)
library(maps)
library(sp)
library(sf)
library(dplyr)
library(ggplot2)
library(scico)
library(rnaturalearth)
library(purrr)
library(smoothr)
library(rgbif)
```

#List of Ecuador Species
```{r}
Ecuador <- BIEN_occurrence_country("Ecuador")
Ecuador_species_list <- unique(Ecuador$scrubbed_species_binomial)
print(length(Ecuador_species_list))
```

#Species Maps for All Ecuador Species
```{r}
Ecuador_plant_range_maps <- BIEN_ranges_species_bulk(Ecuador_species_list, "C:/Users/hj152/Documents/R/EcuadorPlantSpeciesMaps")
```

#Setting up Map
```{r}
# world map
worldMap <- ne_countries(scale = "medium", type = "countries", returnclass = "sf")

# country subset
CRpoly <- worldMap %>% filter(sovereignt == "Ecuador")

# random points tables as a named list
sp_occ <- rerun(12, st_sample(CRpoly, sample(3:20, 1)))
names(sp_occ) <- paste0("sp_", letters[1:length(sp_occ)])

# to sf object
sflisss <-
  purrr::map(sp_occ, st_sf) %>%
  map2(., names(.), ~ mutate(.x, id = .y))

sp_occ_sf <- sflisss %>% reduce(rbind)

# to multipoint
sp_occ_sf <- sp_occ_sf %>%
  group_by(id) %>%
  summarise()

# trim to study area
limsCR <- st_buffer(CRpoly, dist = 0.7) %>% st_bbox()
# neighboring countries
adjacentPolys <- st_touches(CRpoly, worldMap)
neighbours <- worldMap %>% slice(pluck(adjacentPolys, 1))

# countries
divpolPlot <-
  ggplot() +
  geom_sf(data = neighbours, color = "white") +
  geom_sf(data = CRpoly) +
  coord_sf(
    xlim = c(limsCR["xmin"], limsCR["xmax"]),
    ylim = c(limsCR["ymin"], limsCR["ymax"])
  ) +
  scale_x_continuous(breaks = c(-84)) +
  theme(
    plot.background = element_rect(fill = "#f1f2f3"),
    panel.background = element_rect(fill = "#2F4051"),
    panel.grid = element_blank(),
    line = element_blank(),
    rect = element_blank()
  )
divpolPlot

```
