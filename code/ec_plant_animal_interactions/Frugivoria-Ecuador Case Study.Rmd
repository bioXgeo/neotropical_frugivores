---
title: 'Frugivoria: Ecuadorian Birds, Mammals, and Plants'
author: "Beth Gerstner & Hazel Anderson"
date: "6/1/2020"
output:
  pdf_document: default
  html_document: default
---
# Load packages and IUCN API
```{r, message=FALSE}
library(httr) 
library(jsonlite)
library(dplyr)
library(rredlist) 

api_url <- 'https://apiv3.iucnredlist.org/api/v3/'
token <- '3b3db1c753a7cad0616e16146363ec88eead97d185cb3304070d7343123516fd'
```

# Pull in Ecuadorian species from IUCN Redlist
```{r}
#Ecuador
ecuador_species <- rl_sp_country("EC", key = token, parse = TRUE)
c1 <- ecuador_species$result[1]

```

# Break down by species group for the world (will subset to Ecuadorian species)
```{r}

# Get codes for the birds
all_birds <-rl_comp_groups(group = c('birds'), key = token)

# Get codes for the mammals
all_mammals <-rl_comp_groups(group = c('mammals'), key = token)

```

# Mammals and birds occurring in Ecuador 
```{r}

#Mammals

#South America
#extract IUCN results for all mammals and birds from list
all_mammals_df <- as.data.frame(all_mammals[['result']])
all_birds_df <- as.data.frame(all_birds[['result']])

#Mammals
ec_mammals <-all_mammals_df %>%
  filter(taxonid %in% c1$taxonid)


#Birds
ec_birds <-all_birds_df %>%
  filter(taxonid %in% c1$taxonid)

```

# Get habitat for each species --------------------------------------------
# want lowland montane and highland montane species

```{r}
# Include error-checking code in the function so that it will return NA for everything if there's no data.

get_habitat <- function(ID) {
  habitat_by_sp <- GET(url = paste0(api_url, '/habitats/species/id/', ID,'?token=', token))
  habitat_by_sp <- fromJSON(content(habitat_by_sp, as = 'text'), simplifyDataFrame = TRUE, flatten = TRUE)$result
  if (class(habitat_by_sp) == 'data.frame') {
    data.frame(taxonid=ID, habitat_by_sp)
  } else {
    data.frame(taxonid=ID)
  }
}
```

# Apply get_habitat to each row of ec_mammals
```{r}

all_habitat_mammals <- ec_mammals %>%
  rowwise %>%
  do(get_habitat(.$taxonid))




```
#____________________________________________________________________________________________
#### Hazel start your code here! I'll continue adding above